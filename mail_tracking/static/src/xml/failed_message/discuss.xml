<?xml version="1.0" encoding="UTF-8" ?>
<templates>
    <t t-inherit="mail.ThreadIcon" t-inherit-mode="extension">
        <xpath
            expr="//t[@t-elif='thread.mailbox === messaging.history']"
            position="after"
        >
            <t t-elif="thread.mailbox === messaging.failedmsg">
                <div class="o_ThreadIcon_mailboxModeration fa fa-fw fa-exclamation" />
            </t>
        </xpath>
    </t>

    <t t-inherit="mail.DiscussSidebar" t-inherit-mode="extension">
        <xpath
            expr="//div[hasclass('o_DiscussSidebar_categoryMailbox')]"
            position="inside"
        >
            <DiscussSidebarMailbox record="discussView.failedmsgView" />
        </xpath>
    </t>

    <t t-inherit="mail.MessageList" t-inherit-mode="extension">
        <t
            t-elif="messageListView.threadViewOwner.thread === messaging.history.thread"
            position="after"
        >
            <t
                t-if="messageListView.threadViewOwner.thread === messaging.failedmsg.thread"
            >
                <div class="o_MessageList_emptyTitle o-neutral-face-icon">
                    No failed messages
                </div>
                Failed messages will be listed here.
            </t>
        </t>
        <t t-foreach="messageListView.messageListViewItems" position="before">
            <!-- For Failed Messages -->
            <t t-if="className.includes('threadViewFailedMsg')">
                <div
                    class="o_MessageList_separator d-flex flex-shrink-0 align-items-center pt-4 pb-0 px-0 fw-bolder"
                >
                    <hr
                        class="o_MessageList_separatorLine flex-grow-1 w-auto border-top"
                    />
                    <span class="o_MessageList_separatorLabel px-3">
                        Failed messages
                    </span>
                    <hr
                        class="o_MessageList_separatorLine flex-grow-1 w-auto border-top"
                    />
                </div>
            </t>
        </t>
        <t t-if="current_day !== message_day" position="attributes">
            <attribute
                name="t-if"
            >current_day !== message_day and !className.includes('threadViewFailedMsg')</attribute>
        </t>
        <Message position="attributes">
            <attribute
                name="t-if"
            >messageListViewItem.messageView and (!className.includes('threadViewFailedMsg') or messageListViewItem.messageView.message.isFailed)</attribute>
        </Message>
    </t>

    <t t-inherit="mail.Message" t-inherit-mode="extension">
        <div
            class="o_Message_header d-flex flex-wrap align-items-baseline"
            position="inside"
        >
            <t t-if="messageView.message.isFailed">
                <span t-attf-class="o_thread_icons">
                    <a
                        href="#"
                        class="btn btn-link btn-success o_thread_icon text-muted btn-sm o_failed_message_reviewed o_activity_link"
                        t-on-click="_onMarkFailedMessageReviewed"
                        t-att-data-message-id="messageView.message.id"
                    >
                        <i class="fa fa-check" />
                        Set as Reviewed
                    </a>
                    <a
                        href="#"
                        class="btn btn-link btn-success o_thread_icon text-muted btn-sm o_failed_message_retry o_activity_link"
                        t-on-click="_onRetryFailedMessage"
                        t-att-data-message-id="messageView.message.id"
                    >
                        <i class="fa fa-retweet" />
                        Retry
                    </a>
                </span>
            </t>
        </div>
    </t>
</templates>
